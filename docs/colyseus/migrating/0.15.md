# Migrating to version 0.15 (from 0.14)

- [TODO schema "proxy" accessor deprecated]()
- [TODO .auth is gone! no more @colyseus/social built-in]()
- [TODO reconnection token]()
- [`@colyseus/loadtest` changes]()
- [`@colyseus/command` changes]()

## ...

- Schema, TypeScript, "proxy" accessors have been deprecated.
- Reconnection token

## `@colyseus/loadtest` has been reworked!

The loadtest tool has been reworked to allow for more complex scripting, so your loadtest scripts will need to be slightly rewritten, as the new format looks like this:

```typescript
import { Client, Room } from "colyseus.js";
import { Options } from "@colyseus/loadtest";

export async function main(options: Options) {
    const client = new Client(options.endpoint);
    const room: Room = await client.joinOrCreate(options.roomName, {
        // your join options here...
    });

    console.log("joined successfully!");

    room.onMessage("message-type", (payload) => {
        // logic
    });

    room.onStateChange((state) => {
        console.log("state change:", state);
    });

    room.onLeave((code) => {
        console.log("left");
    });
}
```

## `@colyseus/command`

On latest version of `@colyseus/command` (`0.2.0`), instead of providing the state as a generic when extending the `Command`, you now provide your whole `Room` type:

```typescript
import { Command } from "@colyseus/command";

export class MyRoom extends Room<State> {
    // ...
}

export class MyCommand extends Command<MyRoom> {
    // ...
}
```

## `onBeforePatch`, an additional callback has been added!

An additional callback has been added for calling before each time the room state is being sent to clients in particular room.

``````typescript
export class MyRoom extends Room<MyState> {
  // ..
    
  onBeforePatch(state: MyState) {
    console.log(state);
  }
}
``````

## `this.clients` now supports getting the client directly via `sessionId`! 

A new custom data type has been introduced for clients list.

* `add` - Add a client.
* `at` - Get a client by index.
* `concat` - Concatenate with another clients list.
* `delete` - Delete a client from cleints list by it's obejct representation.
* `deleteAt` - Delete a client from clients list by it's index.
* `deleteByKey` - Delete a client from clients list by it's `sessionId`.
* `forEach` - Iterate clients list and pass through a callback.
* `get` - Get a client by it's `sessionId`.
* `includes` - Find whether the given client object is in the clients list.
* `indexOf` - Get the index of a client.
* `map` - Mapping and get a new clients list by passing though a callback.

## Colyseus can now log incoming & outgoing messages!

For aiding debugging, logging incoming and outgoing messages functionality has been added. Below enviroment variable is required.

```
DEBUG=colyseus:messages
```

## Abstract logging support has been added!

It is now supported to add third party/custom logging libraries for printing Colyseus framework related logs. If no logging library has been provided Colyseus will use `console` by default as it's fallback.

i.e. Configuring a third party logging library.

```typescript
import * as winston from "winston";

const LOG: winston.Logger = winston.createLogger({
    format: winston.format.combine(
        winston.format.timestamp(),
        winston.format.json(),
    ),
    level: 'info',
    transports: [
        new winston.transports.File({ filename: 'error.log', level: 'error' }),
        new winston.transports.File({ filename: 'all.log' }),
    ],
});

export default Arena({
    options: {
        logger: LOG
    },
    
    // ..
});
```

Usage:

```typescript
import { Client, logger } from "@colyseus/core";

export class TicTacToeRoom extends Room<> {

  onCreate (options: any) {
    ...
  }

  onJoin(client: Client, options: any) {
    logger.info(client.sessionId, "joined!");
  }

  onLeave (client: Client, consented: boolean) {
    logger.info(client.sessionId, "left!");
  }

  onDispose() {
    logger.info("room", this.roomId, "disposing...");
  }
}
```

